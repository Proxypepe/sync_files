

Xray Watches являются центральным элементом для просмотра и управления нарушениями безопасности и лицензий на платформе JFrog. Watches предоставляют вам гибкость, необходимую для удовлетворения ваших конкретных требований по безопасности и нарушениям. Вы выбираете ресурсы, которые хотите сканировать на предмет уязвимостей и соблюдения нормативных требований, и определяете действия, которые должны быть предприняты после обнаружения уязвимости. Для получения дополнительной информации о том, как JFrog Xray обрабатывает Watches и политики, смотрите раздел "Как Xray сканирует ваши артефакты?".

### Как Xray обрабатывает политики для Watch?

При сканировании артефакта Xray выполняет следующие шаги для каждого ресурса, добавленного в Watch:

1. **Проверка наличия:** Xray проверяет, существует ли артефакт в ресурсе.
    
2. **Проверка фильтров:** Затем Xray проверяет, соответствует ли артефакт всем фильтрам, определенным для этого ресурса.
    
3. **Обработка назначенных политик:** Xray независимо обрабатывает все политики в Watch. Для каждой назначенной политики Xray выполняет следующие шаги:
    
    - Обрабатывает правила в соответствии с их приоритетом.
    - Проверяет критерии правила.
    
    Если критерии соблюдены, Xray генерирует нарушение, выполняются автоматические действия, и политика считается обработанной. Нет необходимости продолжать с последующими правилами в политике.
    
    Если критерии не соблюдены, Xray переходит к следующему правилу.
    
    В случае, если ни одно из правил не применяется, политика считается обработанной, и Xray переходит к следующей политике, если таковая существует.



# Создание Xray Watch 

| #   | Task                                 | Description                                                                                                                                                                | For more information, see... |
| --- | ------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------- |
| 1   | **Configure general watch settings** | Configure general watch settings to determine recipients.                                                                                                                  |                              |
| 2   | **Assign resources to the watch**    | Specify the resources including repositories, builds, Release Bundles, and Projects to monitor, then apply filters to focus only on those artifacts you are interested in. |                              |
| 3   | **Set filters on the watch**         | Determine which artifacts in the repositories specified will generate violations and under what conditions.                                                                |                              |
| 4   | **Assign policies to the watch**     | Assign policies to define when the watch is triggered.                                                                                                                     |                              |



### Настройка общих параметров Watch

1. Перейдите в модуль **Administration**m, в разделе **Watches & Policies** выберите вкладку **Watches** и нажмите **New Watch**.
2. **Заполните общую информацию о Watch:**
- На странице **Create New Watch** введите основную информацию и назначьте получателей для Watch. Если выбраны получатели Watch, они будут получать уведомления по электронной почте в случае обнаружения уязвимости, если политика настроена на уведомление получателей.

![[Pasted image 20240827133647.png]]


![[Pasted image 20240827133710.png]]


### Применение разрешений

- **Просмотр ресурсов в Watch:** Вы можете видеть ресурсы в Watch только в том случае, если они индексированы для сканирования Xray и у вас есть разрешение **"View"** на этот ресурс.
    
- **Добавление и удаление ресурсов в Watch:** Вы можете добавлять или удалять ресурсы из Watch только в том случае, если они индексированы для сканирования Xray и у вас есть разрешение **"Manage"** на этот ресурс.

Следующим шагом является назначение ресурсов для Watch. Ресурсы включают набор репозиториев и сборок в подключенных службах Artifactory, которые Watch будет мониторить. Если вы используете **Projects**, вы можете выбрать их в качестве ресурса.

**Управление ресурсами для Watch включает два шага:**

1. **Указание ресурсов для мониторинга:**
    
    - Определите, какие репозитории, сборки, Release Bundles и Projects будут отслеживаться.
2. **Применение фильтров:**
    
    - Установите фильтры, чтобы сосредоточиться только на тех артефактах в выбранных репозиториях и сборках, которые вас интересуют.

Чтобы назначить ресурсы для Watch, выполните следующие шаги:

1. **Доступ к типам ресурсов:**
    
    - В разделе **Manage Resources** откройте каждый тип ресурса и выберите ресурсы, которые будут мониториться.
2. **Для Projects:**
    
    - **Выбор ресурсов для каждого типа:**
        - У вас есть несколько вариантов выбора ресурсов для включения:
            - **Все ресурсы определенного типа:** Установите флажки **Any Repository, Any Build, Any Bundle** или **Any Project**, чтобы мониторить все ресурсы, которые были указаны для индексации Xray. Учтите, что эта настройка также будет применяться к новым репозиториям и сборкам, созданным после определения Watch.
            - **Пакеты:** Настройте в соответствии с шаблонами **Repo Path Include** и **Repo Path Exclude**.
            - **Сборки и Release Bundles:** Выберите **By Name** или **By Pattern**.
            - **Projects:** Выберите **By Name** или **By Pattern** (ключи проектов).
3. **Перемещение выбранных ресурсов:**
    
    - Переместите интересующие вас ресурсы из списка **Available Resources** (слева) в список **Selected Resources** (справа) перетаскиванием или с помощью стрелок.


### Сканирование внешних ресурсов

Начиная с версии 2.6, при сканировании сборок для поддерживаемых форматов пакетов также сканируются внешние (транзитивные) зависимости, которые не включены напрямую в сборку. Если такие зависимости соответствуют критериям, указанным в Watch, они также будут вызывать нарушения.

В настоящее время поддерживаемые форматы пакетов включают:

- **Maven**
- **NuGet**
- **npm**
- **Gradle**

Сканирование внешних ресурсов выполняется с использованием алгоритма SHA-256.


### Установка фильтров на репозитории

Фильтры, которые вы задаете для Watch, определяют, какие артефакты в указанных репозиториях будут вызывать нарушения и при каких условиях. Вы можете задать любое количество фильтров для каждого из репозиториев, указанных в Watch, и нарушение будет сгенерировано только в том случае, если артефакт соответствует условиям всех фильтров, заданных для этого ресурса.

**Применение всех фильтров:**

- Вы можете задать любое количество фильтров для ресурса, и только артефакты, соответствующие всем фильтрам, вызовут нарушение.

**Для установки фильтров на репозитории:**

1. Перейдите на вкладку **Filters**.
    
2. **Выберите репозиторий:**
    
    - Репозиторий отобразится в правой колонке со списком предустановленных фильтров.
3. **Выберите фильтр:**
    
    - Из списка фильтров **Filter** выберите тот, который вы хотите применить к репозиторию.

**Пример:**

- В следующем примере вы задаете фильтр, который вызовет нарушение для файлов **application/JSON**, если их значение **performance** установлено в **false** в репозитории **docker-local**.


- **Name (Имя):**
    
    - **Описание:** Фильтр **Name** использует регулярное выражение для указания имени артефакта. Watch сработает на нарушение только в том случае, если имя артефакта соответствует выражению.
    - **Пример:** Фильтр задает условие, что нарушение будет сгенерировано только для файлов с расширением `.rpm`.
- **Path (Путь):**
    
    - **Описание:** Фильтр **Path** использует регулярное выражение для указания пути артефакта в репозитории. Watch сработает на нарушение только в том случае, если путь артефакта соответствует выражению. Имейте в виду, что имя репозитория не считается частью пути.
    - **Пример:** Фильтр задает условие, что нарушение будет сгенерировано для артефактов, если в их пути содержится слово "jfrog".
- **Package Type (Тип пакета):**
    - **Описание:** Фильтр **Package Type** задает тип пакета артефакта. Watch сработает на нарушение только в том случае, если у артефакта указан определенный тип пакета.
    - **Пример:** Нарушение будет сгенерировано, если артефакт имеет указанный тип пакета.
- **Mime Type (MIME-тип):**
    
    - **Описание:** Фильтр **Mime Type** задает MIME-тип артефакта. Watch сработает на нарушение только в том случае, если у артефакта указан определенный MIME-тип.
    - **Пример:** Фильтр задает условие, что нарушение будет сгенерировано для любого артефакта с MIME-типом `application/json`.
- **Property (Свойство):**
    - **Описание:** Фильтр **Property** задает свойство, аннотированное для артефакта, и его значение. Watch сработает на нарушение только в том случае, если у свойства артефакта указано определенное значение.
    - **Пример:** Фильтр задает условие, что нарушение будет сгенерировано, если у артефакта есть свойство с именем "performance" и значением "false".

### Назначение политик для Watch

1. **Перейдите в раздел Assigned Policies:**
    
    - Чтобы назначить политику для Watch, нажмите **Manage Policies** в разделе **Assigned Policies**.
2. **Выберите политики:**
    
    - В списке **Available Policies** (слева) выберите политики, которые вы хотите применить к Watch.
    - Переместите выбранные политики в список **Selected Policies** (справа) перетаскиванием или с помощью стрелок.
3. **Сохраните изменения:**
    
    - Нажмите **Save**, чтобы назначить выбранные политики для Watch.



# Редактирование Watch

1. **Выберите Watch:**
    
    - В списке **Watches** выберите тот Watch, который вы хотите отредактировать.
2. **Перейдите на вкладку Settings:**
    
    - После выбора Watch откройте вкладку **Settings** для внесения изменений.



# Ручная активация Watch

После создания Watch он будет сканировать артефакты в указанных ресурсах, когда произойдет событие, запускающее сканирование, и выдавать нарушения в соответствии с результатами сканирования. Однако до наступления такого события артефакты, уже существующие в системе, не будут сканироваться автоматически. Чтобы убедиться, что Watch немедленно применяется к соответствующим артефактам, вы можете активировать его вручную.

1. **Активировать Watch вручную:**
    
    - Наведите курсор на нужный Watch в списке и выберите **Apply on Existing Content** (Применить к существующему контенту).
2. **Выбор ресурсов и диапазона дат:**
    
    - Нажатие кнопки откроет диалоговое окно, в котором можно указать, какие из ресурсов, назначенных для Watch, следует сканировать, а также установить диапазон дат, в течение которого артефакт был последний раз сканирован Xray.
    - Например, выбор **Last 7 days** (Последние 7 дней) будет сканировать только те артефакты, которые были сканированы за последние 7 дней.

**Важно:**

- Функция ручного запуска Watch доступна только для конкретных ресурсов, а не для **All Repositories** (Все репозитории) или **All Builds** (Все сборки).

# Фильтрация Watches

Начиная с версии Xray 3.31.x и выше, вы можете фильтровать список Watches на странице **Watches** в Xray, чтобы отобразить только те Watches, которые актуальны для вас.

**Чтобы использовать фильтры:**

1. **Выберите кнопку фильтрации:**
    
    - Нажмите кнопку **Filter** в верхнем правом углу страницы.
2. **Настройте фильтры:**
    
    - Появится меню фильтров. Используйте доступные параметры фильтрации, чтобы отобразить только те Watches или данные Watch, которые вам нужны.

Это позволяет вам сосредоточиться на нужных Watches и упростить работу с ними.






### Игнорирование нарушений в Xray

В некоторых случаях, когда обнаруживаются нарушения, вам, как сотруднику по безопасности или юридическому специалисту, может потребоваться принять или внести в белый список некоторые из этих нарушений. Это может быть сделано по различным причинам, таким как:

- **Наличие защиты:** Хотя уязвимость реальна, у вас есть способы защиты от нее (например, конфигурация WAF).
- **Несоответствие условий:** Условия, необходимые для возникновения уязвимости, не выполняются в данном случае.
- **Согласие на выпуск:** Как организация, вы осведомлены о нарушении, но все же хотите выпустить продукт.
- **Не является критическим:** Нарушение не является критическим, и вы планируете устранить его в будущих версиях.
- **Ложное срабатывание:** Нарушение является ложным положительным результатом.
- **Необходимость времени:** Нарушение действительно, но вам нужно больше времени для его устранения. Использование временного игнорирования позволяет вам замолчать нарушение на определенный период времени. По истечении этого времени правило игнорирования будет удалено автоматически, и если нарушение произойдет снова, оно больше не будет игнорироваться.

**Функция игнорирования нарушений** предоставляет вам детальный контроль над нарушениями, которые должны быть проигнорированы. Xray позволяет определять область применения правила игнорирования на уровне уязвимости, компонента, артефакта, Watch и других уровней. Это дает вам гибкость и контроль, необходимые для применения правила игнорирования.

## Как настроить игнорирование нарушений:

1. **Определите область применения:**
    
    - Выберите, на каком уровне будет применяться правило игнорирования: уязвимость, компонент, артефакт, Watch и т.д.
2. **Настройте правило игнорирования:**
    
    - Установите параметры для игнорирования, такие как тип нарушения, время действия (если требуется временное игнорирование) и другие настройки.
3. **Примените правило:**
    
    - Сохраните настройки, и правило игнорирования будет применено к выбранным нарушениям.

Используя эти возможности, вы можете эффективно управлять нарушениями и обеспечивать необходимый уровень контроля и гибкости в вашей системе безопасности.

## Создание правила игнорирования нарушения

Чтобы создать правило игнорирования для нарушения, выполните следующие шаги. При создании правила игнорирования оно применяется к конкретному нарушению и ко всем будущим нарушениям, которые соответствуют критериям правила игнорирования. Для примеров случаев, когда может понадобиться игнорировать нарушения, смотрите раздел **Примеры игнорирования нарушений**.

1. **Выберите необходимый Watch:**
    
    - Перейдите на вкладку **Violations**.
    
    Вы также можете просматривать нарушения для **Artifact**, **Build** или **Release Bundle**, выбрав вкладку **Violations** в соответствующем пакете, артефакте, сборке или Release Bundle. Вы можете отфильтровать для отображения только игнорируемых нарушений.
    
2. **Выберите нарушение для игнорирования:**
    
    - В списке нарушений наведите курсор на нужное нарушение и нажмите **Ignore Violation**, расположенную справа от строки.
    
    Появится диалоговое окно **Create Vulnerability Ignore Rule** (Создать правило игнорирования уязвимости).
    
3. **Выберите комбинацию критериев игнорирования:**
    
    - В диалоговом окне выберите комбинацию критериев игнорирования в зависимости от ваших потребностей:
    
    |**Ignore Rule**|**Description**|
    |---|---|
    |**Based on the Vulnerability** (Основано на уязвимости)||
    |Vulnerability ID selected (ID уязвимости выбран)|Правило будет применяться только к конкретной уязвимости.|
    |For any Vulnerability (Для любой уязвимости)|Правило будет применяться ко всем уязвимостям.|
    |**Based on the Component** (Основано на компоненте)||
    |Component name selected current version (Имя компонента выбрано текущая версия)|Правило будет применяться к конкретному компоненту только для этой версии.|
    |Component name selected any version (Имя компонента выбрано любая версия)|Правило будет применяться к конкретному компоненту для всех версий.|
    |For any component (Для любого компонента)|Правило будет применяться ко всем компонентам, содержащим это нарушение.|
    |**Based on the Artifact** (Основано на артефакте)||
    |Artifact name selected current version (Имя артефакта выбрано текущая версия)|Правило будет применяться к конкретному артефакту только для этой версии.|
    |Artifact name selected any version (Имя артефакта выбрано любая версия)|Правило будет применяться к конкретному артефакту для всех версий.|
    |For any Artifact (Для любого артефакта)|Правило будет применяться ко всем артефактам, содержащим это нарушение.|
    |**Based on the Watch** (Основано на Watch)||
    |Specific Watch (Конкретный Watch)|Правило будет применяться к конкретному Watch, где было найдено нарушение.|
    |For any Watch (Для любого Watch)|Правило будет применяться ко всем Watch.|
    |**The ignore rule will expire at** (Правило игнорирования истечет)||
    |Установите дату, когда правило истечет. Это позволит вам сохранить правило игнорирования на определенный период времени. После истечения времени правило игнорирования будет удалено. После этого, если будет запущено сканирование, нарушения будут созданы снова.||
    
4. **Комбинированные критерии:**
    
    - При выборе критериев игнорирования обратите внимание на выбранные комбинации. Некоторые комбинации, такие как выбор всех параметров как **Any** (Любой), не допускаются, так как они будут игнорировать все будущие нарушения (в Watch или в системе).
5. **Использование REST API для Ignore Rules:**
    
    - REST API для правил игнорирования позволяет выбирать более широкий диапазон областей применения правила, а также больше опций в каждой области.

С помощью этих шагов и опций вы можете гибко управлять нарушениями и применить правило игнорирования в соответствии с вашими требованиями.



| **Ignore Rule**<br>                                                                                                                                                                                                                                                 | Описание                                                                  |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------- |
| **Based on the Vulnerability** (Основано на уязвимости)                                                                                                                                                                                                             |                                                                           |
| Vulnerability ID selected (ID уязвимости выбран)                                                                                                                                                                                                                    | Правило будет применяться только к конкретной уязвимости                  |
| For any Vulnerability (Для любой уязвимости)                                                                                                                                                                                                                        | Правило будет применяться ко всем уязвимостям                             |
| **Based on the Component** (Основано на компоненте)**Based on the Component** (Основано на компоненте)                                                                                                                                                              |                                                                           |
| Component name selected current version (Имя компонента выбрано текущая версия)                                                                                                                                                                                     | Правило будет применяться к конкретному компоненту только для этой версии |
| Component name selected any version (Имя компонента выбрано любая версия)                                                                                                                                                                                           | Правило будет применяться к конкретному компоненту для всех версий        |
| For any component (Для любого компонента)                                                                                                                                                                                                                           | Правило будет применяться ко всем компонентам, содержащим это нарушение   |
| **Based on the Artifact** (Основано на артефакте)                                                                                                                                                                                                                   |                                                                           |
| Artifact name selected current version (Имя артефакта выбрано текущая версия)                                                                                                                                                                                       | Правило будет применяться к конкретному артефакту только для этой версии  |
| Artifact name selected any version (Имя артефакта выбрано любая версия)                                                                                                                                                                                             | Правило будет применяться к конкретному артефакту для всех версий         |
| For any Artifact (Для любого артефакта)                                                                                                                                                                                                                             | Правило будет применяться ко всем артефактам, содержащим это нарушение    |
| **Based on the Watch** (Основано на Watch)                                                                                                                                                                                                                          |                                                                           |
| Specific Watch (Конкретный Watch)                                                                                                                                                                                                                                   | Правило будет применяться к конкретному Watch, где было найдено нарушение |
| For any Watch (Для любого Watch)                                                                                                                                                                                                                                    | Правило будет применяться ко всем Watch                                   |
| **The ignore rule will expire at** (Правило игнорирования истечет)                                                                                                                                                                                                  |                                                                           |
| Установите дату, когда правило истечет. Это позволит вам сохранить правило игнорирования на определенный период времени. После истечения времени правило игнорирования будет удалено. После этого, если будет запущено сканирование, нарушения будут созданы снова. |                                                                           |
|                                                                                                                                                                                                                                                                     |                                                                           |
**Комбинированные критерии:**

- При выборе критериев игнорирования обратите внимание на выбранные комбинации. Некоторые комбинации, такие как выбор всех параметров как **Any** (Любой), не допускаются, так как они будут игнорировать все будущие нарушения (в Watch или в системе).
